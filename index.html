<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chase the Ace - Display</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@300;400;600&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Background Animation Container -->
    <div class="background-effects">
        <div class="confetti">♠</div>
        <div class="confetti">♠</div>
        <div class="confetti">♠</div>
        <div class="confetti">♠</div>
        <div class="confetti">♠</div>
        <div class="confetti">♠</div>
        <div class="confetti">♠</div>
        <div class="confetti">♠</div>
    </div>

    <!-- Main Slideshow Container -->
    <div id="slideshow-container">
        
        <!-- Slide 1: Main Title & Logo -->
        <div class="slide active">
            <img src="logo.png" alt="Venue Logo" class="venue-logo" onerror="this.style.display='none'">
            <h1>CHASE THE ACE</h1>
            <img src="ace-of-spades.png" alt="Ace of Spades" class="ace-logo" onerror="this.style.display='none'">
            <h2>Join us for the Draw!</h2>
        </div>

        <!-- Slide 2: Current Jackpot -->
        <div class="slide">
            <h2>CURRENT JACKPOT</h2>
            <div class="jackpot-amount" id="display-jackpot">$0.00</div>
            <p>Jackpot increases by $100 after every draw!</p>
        </div>

        <!-- Slide: Countdown (Only shows between 4pm and draw time) -->
        <div class="slide" id="countdown-slide">
            <h2>DRAW STARTS IN</h2>
            <div class="countdown-timer" id="timer-display">00:00:00</div>
            <div class="countdown-label">GET YOUR TICKETS NOW!</div>
        </div>

        <!-- Slide 3: Tuesday Rules -->
        <div class="slide">
            <h2>TUESDAY DRAW</h2>
            <div class="time-box">
                <h3>Draw Time: 5:30 PM</h3>
            </div>
            <ul class="rules-list">
                <li>Purchase a beverage between <strong>3:00 PM - 5:30 PM</strong></li>
                <li>Receive a ticket for every drink purchased</li>
                <li>Be here for the draw to win!</li>
            </ul>
        </div>

        <!-- Slide 4: Saturday Rules -->
        <div class="slide">
            <h2>SATURDAY DRAW</h2>
            <div class="time-box">
                <h3>Draw Time: 6:30 PM</h3>
            </div>
            <ul class="rules-list">
                <li>Purchase a beverage between <strong>3:00 PM - 6:30 PM</strong></li>
                <li>Receive a ticket for every drink purchased</li>
                <li>Be here for the draw to win!</li>
            </ul>
        </div>

        <!-- Slide 5: How to Win -->
        <div class="slide">
            <h2>HOW TO WIN</h2>
            <p>If your ticket is pulled from the barrel:</p>
            <div class="step-box">
                <p>1. Pick a card from the cabinet (52 Cards)</p>
                <p>2. Flip the <strong>ACE OF SPADES</strong></p>
                <p>3. WIN THE JACKPOT!</p>
            </div>
        </div>

    </div>

    <script>
        // --- Configuration ---
        const slideDuration = 8000; // 8 seconds per slide

        // --- Slideshow Logic ---
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        let isCountdownActive = false;

        function nextSlide() {
            // Remove active class from current
            slides[currentSlide].classList.remove('active');
            
            // Find next valid slide (skip countdown if not active)
            let loopCount = 0;
            do {
                currentSlide = (currentSlide + 1) % slides.length;
                loopCount++;
                if (loopCount > slides.length) break; // Safety break
            } while (slides[currentSlide].id === 'countdown-slide' && !isCountdownActive);
            
            // Add active class to next
            slides[currentSlide].classList.add('active');
        }

        // Start the rotation
        setInterval(nextSlide, slideDuration);

        // --- Jackpot Logic ---
        // TODO: Paste your Google Sheet CSV URL here inside the quotes
        // Example: "https://docs.google.com/spreadsheets/d/e/2PACX-.../pub?output=csv"
        const googleSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTWKQ868KUAuJv03Z4ULML1XtCTp7aJ8066j17W5pAYpT9yTj0foQt-PMa3aJCViFC6pzKX3jZU8pnk/pub?output=csv"; 

        async function updateJackpotDisplay() {
            const displayEl = document.getElementById('display-jackpot');
            
            // Fallback to local storage if URL isn't set yet
            if (!googleSheetUrl) {
                const storedAmount = localStorage.getItem('cta_jackpot');
                if (storedAmount) displayEl.innerText = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'NZD' }).format(storedAmount);
                else if (displayEl.innerText === "$0.00") displayEl.innerText = "$500.00";
                return;
            }

            try {
                // Fetch data from Google Sheets (adding timestamp to prevent caching)
                const response = await fetch(googleSheetUrl + '&t=' + Date.now());
                const text = await response.text();
                
                // Clean the text to get just the number
                const amount = parseFloat(text.replace(/[^0-9.]/g, ''));
                
                if (!isNaN(amount)) {
                    displayEl.innerText = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
                }
            } catch (e) { console.error("Error fetching jackpot:", e); }
        }

        // Check for jackpot updates every 5 seconds (in case admin updates it)
        updateJackpotDisplay();
        setInterval(updateJackpotDisplay, 60000);

        // --- Countdown Logic (NZ Time) ---
        function updateCountdown() {
            const now = new Date();
            // Create date object based on NZ time
            const nzTimeStr = now.toLocaleString("en-US", {timeZone: "Pacific/Auckland"});
            const nzDate = new Date(nzTimeStr);
            
            const day = nzDate.getDay(); // 0=Sun, 1=Mon, 2=Tue... 6=Sat
            const hours = nzDate.getHours();
            const minutes = nzDate.getMinutes();
            
            let target = null;
            
            // Tuesday (Day 2): Active 4:00 PM (16:00) to 5:30 PM (17:30)
            if (day === 2 && (hours >= 16 && (hours < 17 || (hours === 17 && minutes < 30)))) {
                target = new Date(nzDate);
                target.setHours(17, 30, 0, 0);
            }
            
            // Saturday (Day 6): Active 4:00 PM (16:00) to 6:30 PM (18:30)
            if (day === 6 && (hours >= 16 && (hours < 18 || (hours === 18 && minutes < 30)))) {
                target = new Date(nzDate);
                target.setHours(18, 30, 0, 0);
            }

            if (target) {
                isCountdownActive = true;
                const diff = target - nzDate;
                
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('timer-display').innerText = 
                    (h < 10 ? "0" + h : h) + ":" + (m < 10 ? "0" + m : m) + ":" + (s < 10 ? "0" + s : s);
            } else {
                isCountdownActive = false;
            }
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();
    </script>
</body>
</html>
